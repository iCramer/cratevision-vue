{"remainingRequest":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/iancramer/GitHub/bundlevo-vue/src/pages/products/new-product.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/iancramer/GitHub/bundlevo-vue/src/pages/products/new-product.vue","mtime":1582812150951},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1557780378880},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":1557780376697},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-plugin-typescript/node_modules/ts-loader/index.js","mtime":1557881577950},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1557780378880},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1557780379303}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport {\n  Panel,\n  AppTable,\n  AppButton,\n  ButtonGroup,\n  TitleBar,\n  InputField,\n  InputValidate,\n  Radio,\n  SelectBox,\n  Counter,\n  ListGroup,\n  ListGroupItem,\n  Badge,\n  Tab,\n  NoResults,\n  FileUploader,\n  Dropdown,\n  FeeEditor,\n  FeeInput,\n  Modal,\n  ErrorBanner,\n  Toggle,\n  Pagination,\n  SectionTitle\n} from '@/components';\nimport { ValidationObserver } from 'vee-validate';\nimport api from '@/api';\nimport { IProduct, IProductItem, IFee, VForm, IProductIdentifier } from '@/interfaces';\nimport { DoughnutChart } from '@/charts';\nimport ProductItemPanel from './product-item-panel.vue';\nimport NewProductItem from './product-items/new-product-item.vue';\nimport deepCopy from '@/utils';\nimport InventoryForm from '@/pages/products/product-items/inventory-form.vue';\nimport ProductIdentifierForm from '@/pages/products/product-items/product-identifier-form.vue';\nimport { WarehouseEditor } from '@/patterns';\n\n@Component({\n  components: {\n    Panel,\n    AppTable,\n    AppButton,\n    ButtonGroup,\n    TitleBar,\n    InputField,\n    InputValidate,\n    Radio,\n    SelectBox,\n    Counter,\n    ListGroup,\n    ListGroupItem,\n    Badge,\n    ProductItemPanel,\n    Tab,\n    NoResults,\n    DoughnutChart,\n    FileUploader,\n    Dropdown,\n    FeeEditor,\n    FeeInput,\n    NewProductItem,\n    Modal,\n    ValidationObserver,\n    ErrorBanner,\n    Toggle,\n    Pagination,\n    SectionTitle,\n    InventoryForm,\n    ProductIdentifierForm,\n    WarehouseEditor\n  }\n})\nexport default class NewProduct extends Vue {\n  productItems: IProductItem[] = [];\n  filteredProdItems: IProductItem[] = [];\n  newProduct: IProduct = {\n    productItemQuantities: [],\n    images: [],\n    fees: [],\n    inventory: [{}],\n    productIdentifiers: [{}]\n  };\n  statusOptions = [];\n  selectedProdItem: IProduct = {};\n  showProdDetails = false;\n  columns = [\n    { label: 'Quantity', slotName: 'count' },\n    { label: 'Name', slotName: 'name' },\n    { label: 'Case Quantity', selector: 'caseQty' },\n    { label: 'Case Cost', selector: 'caseCost' },\n    { label: 'Item Cost', selector: 'itemCost' },\n    { label: 'Supplier', selector: 'supplier.name' }\n  ];\n  chartData: any = {};\n  summaryData: any = {};\n  chartOptions = {\n    responsive: true,\n    maintainAspectRatio: true,\n    legend: { position: 'bottom', labels: { boxWidth: 15, fontSize: 14, fontColor: '#444'}}\n  };\n  showModal = false;\n  showFeeModal = false;\n  showImageModal = false;\n  showWarehouseModal = false;\n  errorList: string[] = [];\n\n  created() {\n    this.getProductItems();\n    this.getStatuses();\n  }\n\n  @Watch('newProduct', {deep: true})\n  updateCost() {\n    this.calculateCost();\n  }\n\n  hasInfo() {\n    const product = this.newProduct;\n    return product.name || product.productItemQuantities.length || product.fees.length || product.images.length;\n  }\n\n  getProductItems() {\n    api.get('productitem/all').then(resp => {\n      this.productItems = resp.data;\n      this.filteredProdItems = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  changePage(range) {\n    let prodItems = deepCopy(this.productItems);\n    if(prodItems) {\n      this.filteredProdItems = prodItems.splice(range.start, range.end);\n    }\n  }\n\n  getStatuses() {\n    api.get('status/all').then(resp => {\n      this.statusOptions = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  hasCost() {\n    let product = this.newProduct;\n    return product.msrp || product.fees.length || product.productItemQuantities.length;\n  }\n\n  calculateCost() {\n    let product = this.newProduct;\n    if(!this.hasCost()) {\n      return;\n    }\n\n    let fees = 0;\n    this.newProduct.fees.length && this.newProduct.fees.forEach( fee => {\n      fees += fee.amount;\n    });\n\n    let cost: number;\n    let prodItemsCost = undefined;\n      prodItemsCost = 0;\n      product.productItemQuantities.forEach( item => {\n        prodItemsCost += item.productItem.itemCost * item.count;\n      });\n      prodItemsCost = parseInt(prodItemsCost.toFixed(2));\n      cost = fees + prodItemsCost;\n\n    let profit = parseInt((product.msrp - cost).toFixed(2));\n    if(profit < 0) {\n      profit = 0;\n    }\n\n    let labels = ['Fees', 'Product Cost', 'Profit'];\n    let data = [fees, prodItemsCost, profit];\n\n    this.chartData = {\n      labels: labels,\n      datasets: [{\n        data: data,\n        backgroundColor: ['#ffcd56', '#36a2eb', '#00ad10']\n      }]\n    }\n\n    this.summaryData = {\n      msrp: product.msrp,\n      fees: fees,\n      prodItemsCost: prodItemsCost,\n      profit: profit\n    }\n\n  }\n\n  findCountObj(id) {\n    let prodQty = this.newProduct.productItemQuantities;\n    return prodQty.find(item => item.productItem.id === id);\n  }\n\n  getCount(item) {\n    let countItem = this.findCountObj(item.id);\n    return countItem ? countItem.count : 0;\n  }\n\n  changeCount(val, item) {\n    let countItem = this.findCountObj(item.id);\n    let prodQty = this.newProduct.productItemQuantities;\n    let count = val !== '' ? parseInt(val) : 0;\n    if (countItem) {\n      if (count === 0) {\n        let index = prodQty.findIndex(obj => obj.productItem.id === item.id);\n        prodQty.splice(index, 1);\n      }\n      else {\n        countItem.count = count;\n      }\n    }\n    else {\n      prodQty.push({ count: count, productItem: item });\n    }\n    this.calculateCost();\n  }\n\n  addInventory() {\n    this.newProduct.inventory.push({});\n  }\n\n  removeInventory(index) {\n    this.newProduct.inventory.splice(index, 1);\n  }\n\n  addProdId() {\n    this.newProduct.productIdentifiers.push({});\n  }\n\n  removeProdId(index) {\n    this.newProduct.productIdentifiers.splice(index, 1);\n  }\n\n  removeImage(image) {\n    this.newProduct.images = this.newProduct.images.filter( item => item.id != image.id);\n  }\n\n  openDetails(prodItem) {\n    this.selectedProdItem = prodItem;\n    this.showProdDetails = true;\n  }\n\n  closeDetails(product) {\n    this.selectedProdItem = {};\n    this.showProdDetails = false;\n  }\n\n  openModal() {\n    this.showModal = true;\n  }\n\n  closeModal() {\n    this.showModal = false;\n  }\n\n  saveNewItem(value) {\n    api.post('productitem/', value).then(resp => {\n      this.$toast.success('New product item created');\n      this.getProductItems();\n    }).catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n    this.closeModal();\n  }\n\n  clearForm() {\n    this.newProduct = {\n      productItemQuantities: [],\n      images: [],\n      fees: [],\n      inventory: [{}],\n      productIdentifiers: [{}]\n    };\n    this.chartData.datasets = {};\n    (this.$refs.newProduct as VForm).reset();\n  }\n\n  submitForm() {\n    (this.$refs.newProduct as VForm).validate().then( valid => {\n      if(valid) {\n        api.post('product/', this.newProduct).then( () => {\n          this.$toast.success('New product created');\n          this.clearForm();\n        })\n        .catch(error => {\n          this.errorList.push(error.response.data.message);\n        });\n      }\n    });\n  }\n}\n",{"version":3,"sources":["new-product.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"new-product.vue","sourceRoot":"src/pages/products","sourcesContent":["<template>\n  <div>\n    <title-bar title=\"New Product\" btnBackLabel=\"All Products\" routeBack=\"/products/all-products\" />\n    <div class=\"container-fluid\">\n      <error-banner v-model=\"errorList\" />\n      <div class=\"row\">\n        <div class=\"col-md-7\">\n          <panel title=\"Product Information\">\n            <validation-observer ref=\"newProduct\">\n              <div class=\"row\">\n                <div class=\"col-md-7\">\n                  <input-validate name=\"name\" label=\"Name\" rules=\"required\" v-model.trim=\"newProduct.name\" />\n                </div>\n                <div class=\"col-md-5\">\n                  <input-validate name=\"msrp\" label=\"MSRP\" inputType=\"number\" step=\".01\" v-model.number=\"newProduct.msrp\" rules=\"required\" />\n                </div>\n                <div class=\"col-md-6\">\n                  <select-box name=\"status\" label=\"Status\" v-model=\"newProduct.status\" :options=\"statusOptions\"></select-box>\n                </div>\n              </div>\n            </validation-observer>\n          </panel>\n          <transition name=\"expand\">\n            <panel title=\"Product Items\">\n              <app-button slot=\"utility\" :linkBtn=\"true\" icon=\"plus-circle\" @click=\"openModal\">New Product Item</app-button>\n              <app-table :columns=\"columns\" :records=\"filteredProdItems\">\n                <counter slot=\"count\" slot-scope=\"{record}\" :value=\"getCount(record)\" @input=\"(val) => changeCount(val, record)\"></counter>\n                <app-button slot=\"name\" slot-scope=\"{record}\" size=\"xs\" btnStyle=\"link\" @click=\"openDetails(record)\">{{record.name}}</app-button>\n              </app-table>\n              <pagination :totalRecords=\"productItems.length\" @change=\"changePage\" />\n            </panel>\n          </transition>\n          <panel title=\"Product Identifiers\">\n            <div v-for=\"(item, index) in newProduct.productIdentifiers\">\n              <section-title :showBtn=\"index !== 0\" btnIcon=\"trash-alt\" sectionType=\"form\" @util-click=\"removeProdId(index)\" :class=\"{'mt-4': index !== 0}\">Product Identifier  #{{index + 1}}</section-title>\n              <product-identifier-form v-model=\"newProduct.productIdentifiers[index]\" />\n            </div>\n            <app-button btnStyle=\"info-link\" size=\"xs\" icon=\"plus-circle\" @click=\"addProdId\">Add Identifier</app-button>\n          </panel>\n          <panel title=\"Fees\">\n            <fee-input v-model=\"newProduct.fees\" @edit-click=\"showFeeModal = true\" />\n          </panel>\n          <panel title=\"Images\">\n            <file-uploader v-model=\"newProduct.images\" />\n          </panel>\n          <panel title=\"Inventory\">\n            <div v-for=\"(item, index) in newProduct.inventory\">\n              <section-title :showBtn=\"index !== 0\" btnIcon=\"trash-alt\" sectionType=\"form\" :class=\"{'mt-4': index !== 0}\" @util-click=\"removeInventory(index)\">Inventory  #{{index + 1}}</section-title>\n              <inventory-form v-model=\"newProduct.inventory[index]\" @edit-click=\"showWarehouseModal = true\" />\n            </div>\n            <app-button btnStyle=\"info-link\" size=\"xs\" icon=\"plus-circle\" @click=\"addInventory\">Add Inventory</app-button>\n          </panel>\n        </div>\n        <div class=\"col-md-5\">\n          <panel title=\"Product Summary\">\n            <doughnut-chart v-if=\"chartData.datasets && chartData.datasets.length\" :innerText=\"summaryData.msrp\" :height=\"220\" :chartData=\"chartData\" :options=\"chartOptions\" />\n            <no-results v-else icon=\"chart-pie\" />\n            <div v-if=\"hasInfo()\">\n              <transition name=\"expand\">\n                <list-group v-if=\"summaryData\" :iconList=\"false\" title=\"Cost Breakdown\">\n                  <list-group-item>\n                    MSRP <badge>{{summaryData.msrp | currency}}</badge>\n                  </list-group-item>\n                  <list-group-item>\n                    Fees <badge>{{summaryData.fees | currency}}</badge>\n                  </list-group-item>\n                  <list-group-item v-show=\"summaryData.prodItemsCost\">\n                    Product Cost <badge>{{summaryData.prodItemsCost | currency}}</badge>\n                  </list-group-item>\n                  <list-group-item>\n                    Profit <badge badgeStyle=\"success\">{{summaryData.profit | currency}}</badge>\n                  </list-group-item>\n                </list-group>\n              </transition>\n              <transition name=\"expand\">\n                <list-group>\n                  <list-group-item v-if=\"newProduct.name\" icon=\"address-card\"><span>Name</span> {{newProduct.name}}</list-group-item>\n                  <list-group-item v-if=\"newProduct.status && newProduct.status.name\" icon=\"ellipsis-h\"><span>Status</span> <badge badgeType=\"outline\">{{newProduct.status.name}}</badge></list-group-item>\n                </list-group>\n              </transition>\n              <transition name=\"expand\">\n                <list-group title=\"Product Items\" v-if=\"newProduct.productItemQuantities.length\" :iconList=\"false\">\n                  <list-group-item v-for=\"(item, index) in newProduct.productItemQuantities\" :key=\"'item-' + index\">\n                    {{item.productItem.name}} <badge badgeStyle=\"info\">{{item.count}}</badge>\n                  </list-group-item>\n                </list-group>\n              </transition>\n              <transition name=\"expand\">\n                <list-group title=\"Fees\" v-if=\"newProduct.fees.length\" :iconList=\"false\">\n                  <list-group-item v-for=\"(fee, index) in newProduct.fees\" :key=\"'fee-' + index\">\n                    {{fee.name}} <badge badgeStyle=\"info\">{{ fee.amount | fee(fee.type) }}</badge>\n                  </list-group-item>\n                </list-group>\n              </transition>\n              <transition name=\"expand\">\n                <list-group title=\"Images\" v-if=\"newProduct.images && newProduct.images.length\" :iconList=\"false\">\n                  <list-group-item v-for=\"(image, index) in newProduct.images\" :key=\"'image-' + index\">\n                    {{image.name}} <app-button size=\"xs\" :linkBtn=\"true\" @click=\"removeImage(image)\" icon=\"trash-alt\" />\n                  </list-group-item>\n                </list-group>\n              </transition>\n              <button-group align=\"center\">\n                <app-button :linkBtn=\"true\" @click=\"clearForm\">Cancel</app-button>\n                <app-button btnType=\"submit\" @click=\"submitForm\">Submit</app-button>\n              </button-group>\n            </div>\n          </panel>\n        </div>\n      </div>\n      <product-item-panel @close=\"closeDetails\" :open=\"showProdDetails\" :item=\"selectedProdItem\" />\n    </div>\n    <modal size=\"lg\" title=\"New Product Item\" :open=\"showModal\">\n      <new-product-item @cancel=\"closeModal\" @submit=\"saveNewItem\" />\n    </modal>\n    <modal title=\"Edit Fees\" :open=\"showFeeModal\">\n      <fee-editor />\n      <button-group>\n        <app-button @click=\"showFeeModal = false\">Done</app-button>\n      </button-group>\n    </modal>\n    <modal title=\"Images\" :open=\"showImageModal\">\n      <file-uploader v-model=\"newProduct.images\" />\n      <button-group>\n        <app-button @click=\"showImageModal = false\">Done</app-button>\n      </button-group>\n    </modal>\n    <modal title=\"Warehouses\" :open=\"showWarehouseModal\">\n      <warehouse-editor />\n      <button-group>\n        <app-button @click=\"showWarehouseModal = false\">Done</app-button>\n      </button-group>\n    </modal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport {\n  Panel,\n  AppTable,\n  AppButton,\n  ButtonGroup,\n  TitleBar,\n  InputField,\n  InputValidate,\n  Radio,\n  SelectBox,\n  Counter,\n  ListGroup,\n  ListGroupItem,\n  Badge,\n  Tab,\n  NoResults,\n  FileUploader,\n  Dropdown,\n  FeeEditor,\n  FeeInput,\n  Modal,\n  ErrorBanner,\n  Toggle,\n  Pagination,\n  SectionTitle\n} from '@/components';\nimport { ValidationObserver } from 'vee-validate';\nimport api from '@/api';\nimport { IProduct, IProductItem, IFee, VForm, IProductIdentifier } from '@/interfaces';\nimport { DoughnutChart } from '@/charts';\nimport ProductItemPanel from './product-item-panel.vue';\nimport NewProductItem from './product-items/new-product-item.vue';\nimport deepCopy from '@/utils';\nimport InventoryForm from '@/pages/products/product-items/inventory-form.vue';\nimport ProductIdentifierForm from '@/pages/products/product-items/product-identifier-form.vue';\nimport { WarehouseEditor } from '@/patterns';\n\n@Component({\n  components: {\n    Panel,\n    AppTable,\n    AppButton,\n    ButtonGroup,\n    TitleBar,\n    InputField,\n    InputValidate,\n    Radio,\n    SelectBox,\n    Counter,\n    ListGroup,\n    ListGroupItem,\n    Badge,\n    ProductItemPanel,\n    Tab,\n    NoResults,\n    DoughnutChart,\n    FileUploader,\n    Dropdown,\n    FeeEditor,\n    FeeInput,\n    NewProductItem,\n    Modal,\n    ValidationObserver,\n    ErrorBanner,\n    Toggle,\n    Pagination,\n    SectionTitle,\n    InventoryForm,\n    ProductIdentifierForm,\n    WarehouseEditor\n  }\n})\nexport default class NewProduct extends Vue {\n  productItems: IProductItem[] = [];\n  filteredProdItems: IProductItem[] = [];\n  newProduct: IProduct = {\n    productItemQuantities: [],\n    images: [],\n    fees: [],\n    inventory: [{}],\n    productIdentifiers: [{}]\n  };\n  statusOptions = [];\n  selectedProdItem: IProduct = {};\n  showProdDetails = false;\n  columns = [\n    { label: 'Quantity', slotName: 'count' },\n    { label: 'Name', slotName: 'name' },\n    { label: 'Case Quantity', selector: 'caseQty' },\n    { label: 'Case Cost', selector: 'caseCost' },\n    { label: 'Item Cost', selector: 'itemCost' },\n    { label: 'Supplier', selector: 'supplier.name' }\n  ];\n  chartData: any = {};\n  summaryData: any = {};\n  chartOptions = {\n    responsive: true,\n    maintainAspectRatio: true,\n    legend: { position: 'bottom', labels: { boxWidth: 15, fontSize: 14, fontColor: '#444'}}\n  };\n  showModal = false;\n  showFeeModal = false;\n  showImageModal = false;\n  showWarehouseModal = false;\n  errorList: string[] = [];\n\n  created() {\n    this.getProductItems();\n    this.getStatuses();\n  }\n\n  @Watch('newProduct', {deep: true})\n  updateCost() {\n    this.calculateCost();\n  }\n\n  hasInfo() {\n    const product = this.newProduct;\n    return product.name || product.productItemQuantities.length || product.fees.length || product.images.length;\n  }\n\n  getProductItems() {\n    api.get('productitem/all').then(resp => {\n      this.productItems = resp.data;\n      this.filteredProdItems = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  changePage(range) {\n    let prodItems = deepCopy(this.productItems);\n    if(prodItems) {\n      this.filteredProdItems = prodItems.splice(range.start, range.end);\n    }\n  }\n\n  getStatuses() {\n    api.get('status/all').then(resp => {\n      this.statusOptions = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  hasCost() {\n    let product = this.newProduct;\n    return product.msrp || product.fees.length || product.productItemQuantities.length;\n  }\n\n  calculateCost() {\n    let product = this.newProduct;\n    if(!this.hasCost()) {\n      return;\n    }\n\n    let fees = 0;\n    this.newProduct.fees.length && this.newProduct.fees.forEach( fee => {\n      fees += fee.amount;\n    });\n\n    let cost: number;\n    let prodItemsCost = undefined;\n      prodItemsCost = 0;\n      product.productItemQuantities.forEach( item => {\n        prodItemsCost += item.productItem.itemCost * item.count;\n      });\n      prodItemsCost = parseInt(prodItemsCost.toFixed(2));\n      cost = fees + prodItemsCost;\n\n    let profit = parseInt((product.msrp - cost).toFixed(2));\n    if(profit < 0) {\n      profit = 0;\n    }\n\n    let labels = ['Fees', 'Product Cost', 'Profit'];\n    let data = [fees, prodItemsCost, profit];\n\n    this.chartData = {\n      labels: labels,\n      datasets: [{\n        data: data,\n        backgroundColor: ['#ffcd56', '#36a2eb', '#00ad10']\n      }]\n    }\n\n    this.summaryData = {\n      msrp: product.msrp,\n      fees: fees,\n      prodItemsCost: prodItemsCost,\n      profit: profit\n    }\n\n  }\n\n  findCountObj(id) {\n    let prodQty = this.newProduct.productItemQuantities;\n    return prodQty.find(item => item.productItem.id === id);\n  }\n\n  getCount(item) {\n    let countItem = this.findCountObj(item.id);\n    return countItem ? countItem.count : 0;\n  }\n\n  changeCount(val, item) {\n    let countItem = this.findCountObj(item.id);\n    let prodQty = this.newProduct.productItemQuantities;\n    let count = val !== '' ? parseInt(val) : 0;\n    if (countItem) {\n      if (count === 0) {\n        let index = prodQty.findIndex(obj => obj.productItem.id === item.id);\n        prodQty.splice(index, 1);\n      }\n      else {\n        countItem.count = count;\n      }\n    }\n    else {\n      prodQty.push({ count: count, productItem: item });\n    }\n    this.calculateCost();\n  }\n\n  addInventory() {\n    this.newProduct.inventory.push({});\n  }\n\n  removeInventory(index) {\n    this.newProduct.inventory.splice(index, 1);\n  }\n\n  addProdId() {\n    this.newProduct.productIdentifiers.push({});\n  }\n\n  removeProdId(index) {\n    this.newProduct.productIdentifiers.splice(index, 1);\n  }\n\n  removeImage(image) {\n    this.newProduct.images = this.newProduct.images.filter( item => item.id != image.id);\n  }\n\n  openDetails(prodItem) {\n    this.selectedProdItem = prodItem;\n    this.showProdDetails = true;\n  }\n\n  closeDetails(product) {\n    this.selectedProdItem = {};\n    this.showProdDetails = false;\n  }\n\n  openModal() {\n    this.showModal = true;\n  }\n\n  closeModal() {\n    this.showModal = false;\n  }\n\n  saveNewItem(value) {\n    api.post('productitem/', value).then(resp => {\n      this.$toast.success('New product item created');\n      this.getProductItems();\n    }).catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n    this.closeModal();\n  }\n\n  clearForm() {\n    this.newProduct = {\n      productItemQuantities: [],\n      images: [],\n      fees: [],\n      inventory: [{}],\n      productIdentifiers: [{}]\n    };\n    this.chartData.datasets = {};\n    (this.$refs.newProduct as VForm).reset();\n  }\n\n  submitForm() {\n    (this.$refs.newProduct as VForm).validate().then( valid => {\n      if(valid) {\n        api.post('product/', this.newProduct).then( () => {\n          this.$toast.success('New product created');\n          this.clearForm();\n        })\n        .catch(error => {\n          this.errorList.push(error.response.data.message);\n        });\n      }\n    });\n  }\n}\n</script>\n"]}]}