{"remainingRequest":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/iancramer/GitHub/bundlevo-vue/src/pages/products/product-info.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/iancramer/GitHub/bundlevo-vue/src/pages/products/product-info.vue","mtime":1564768508916},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1557780378880},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":1557780376697},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-plugin-typescript/node_modules/ts-loader/index.js","mtime":1557881577950},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1557780378880},{"path":"/Users/iancramer/GitHub/bundlevo-vue/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1557780379303}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Vue } from 'vue-property-decorator';\nimport {\n  Panel,\n  ListGroup,\n  ListGroupItem,\n  NoResults,\n  Badge,\n  DataImage,\n  AppTable,\n  Modal,\n  AppButton,\n  Counter,\n  SectionTitle,\n  ImageGallery,\n  InputField,\n  InputValidate,\n  MultiSelect,\n  StatusSelect,\n  Radio,\n  FeeInput,\n  FeeEditor,\n  ImageEditor,\n  ButtonGroup,\n  ErrorBanner,\n  Toggle,\n  Pagination\n} from '@/components';\nimport { DoughnutChart } from '@/charts';\nimport api from '@/api';\nimport { IProduct, IProductItem, IProductItemQuantity, IFee, IMedia, VForm } from '@/interfaces';\nimport ProductItemPanel from './product-item-panel.vue';\nimport NewProductItem from './product-items/new-product-item.vue';\nimport deepCopy from '@/utils';\nimport { ValidationObserver } from 'vee-validate';\nimport ProductIdentifier from './product-items/product-identifier.vue';\nimport Inventory from './product-items/inventory.vue';\n\n@Component({\n  components: {\n    Panel,\n    ListGroup,\n    ListGroupItem,\n    Badge,\n    DoughnutChart,\n    NoResults,\n    DataImage,\n    AppTable,\n    Modal,\n    ProductItemPanel,\n    AppButton,\n    Counter,\n    NewProductItem,\n    SectionTitle,\n    ImageGallery,\n    InputField,\n    InputValidate,\n    MultiSelect,\n    StatusSelect,\n    Radio,\n    FeeInput,\n    FeeEditor,\n    ImageEditor,\n    ButtonGroup,\n    ValidationObserver,\n    ErrorBanner,\n    Toggle,\n    ProductIdentifier,\n    Inventory,\n    Pagination\n  }\n})\nexport default class ProductInfo extends Vue {\n  product: IProduct = {};\n  chartData: any = {};\n  summaryData: any = {};\n  productImages = [];\n  productItems: IProductItem[] = [];\n  filteredProdItems: IProductItem[] = [];\n  productItemQty: IProductItemQuantity[] = [];\n  selectedItem = {};\n  showDetails = false;\n  saveDisabled = true;\n  showNewItemModal = false;\n  editProdItems = false;\n  showBasicModal = false;\n  basicInfoEditObj: IProduct = {};\n  showFeeModal = false;\n  editFeeOptions = false;\n  feeEditArr: IFee[] = [];\n  showImageModal = false;\n  images: IMedia[] = [];\n  selectedImages: IMedia[];\n  itemCols = [\n    { label: 'Quantity', slotName: 'count' },\n    { label: 'Name', slotName: 'name' },\n    { label: 'Case Cost', selector: 'caseCost' },\n    { label: 'Item Cost', selector: 'itemCost' },\n    { label: 'Supplier', selector: 'supplier.name' }\n  ];\n  statusOptions = [];\n  errorList: string[] = [];\n  chartOptions = {\n    responsive: true,\n    maintainAspectRatio: true,\n    legend: { position: 'bottom', labels: { boxWidth: 15, fontSize: 14, fontColor: '#444'}}\n  };\n\n  created() {\n    this.getProduct();\n    this.getStatuses();\n  }\n\n  getProduct() {\n    const id = this.$route.params.id;\n    api.get('product/' + id).then(resp => {\n      this.product = resp.data;\n      this.productItemQty = this.product.productItemQuantities || [];\n      if(this.productItemQty.length) {\n        this.getProductItems();\n      }\n      this.calculateCost();\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  getProductItems() {\n    api.get('productitem/all').then(resp => {\n      this.productItems = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  getStatuses() {\n    api.get('status/all').then(resp => {\n      this.statusOptions = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  calculateCost() {\n    let product = this.product;\n    let fees = 0;\n    product.fees.forEach( fee => {\n      fees += fee.amount;\n    });\n\n    let prodItemsCost = 0;\n    product.productItemQuantities.forEach( item => {\n      prodItemsCost += item.productItem.itemCost * item.count;\n    });\n    prodItemsCost = parseInt(prodItemsCost.toFixed(2));\n    const cost = fees + prodItemsCost;\n    let profit = parseInt((product.msrp - cost).toFixed(2));\n    if(profit < 0) {\n      profit = 0;\n    }\n\n    this.chartData = {\n      labels: ['Fees', 'Product Cost', 'Profit'],\n      datasets: [{\n        data: [fees, prodItemsCost, profit],\n        backgroundColor: ['#ff6384', '#ffcd56', '#00ad10']\n      }]\n    }\n\n    this.summaryData = {\n      msrp: product.msrp,\n      fees: fees,\n      prodItemsCost: prodItemsCost,\n      profit: profit\n    }\n  }\n\n  changePage(range) {\n    let prodItems = deepCopy(this.productItems);\n    this.filteredProdItems = prodItems.splice(range.start, range.end);\n  }\n\n  prodItemEditStart() {\n    this.filteredProdItems = this.productItems;\n    this.editProdItems = true;\n  }\n\n  prodItemEditEnd() {\n    this.filteredProdItems = this.productItems.filter(item => this.getCount(item) > 0);\n    this.editProdItems = false;\n  }\n\n  findCountObj(id) {\n    return this.productItemQty.find(item => item.productItem.id === id);\n  }\n\n  getCount(item) {\n    let countItem = this.findCountObj(item.id);\n    return countItem ? countItem.count : 0;\n  }\n\n  changeCount(val, item) {\n    let countItem = this.findCountObj(item.id);\n    let prodItemQty = this.productItemQty;\n    let count = val !== '' ? parseInt(val) : 0;\n    if (countItem) {\n      if (count === 0) {\n        let index = prodItemQty.findIndex(obj => obj.productItem.id === item.id);\n        prodItemQty.splice(index, 1);\n      }\n      else {\n        countItem.count = count;\n      }\n    }\n    else {\n      prodItemQty.push({ count: count, productItem: item });\n    }\n    this.calculateCost();\n    this.saveDisabled = false;\n  }\n\n  openDetails(obj) {\n    this.showDetails = true;\n    this.selectedItem = obj;\n  }\n\n  closeDetails() {\n    this.showDetails = false;\n    this.selectedItem = {};\n  }\n\n  openNewItemModal() {\n    this.showNewItemModal = true;\n  }\n\n  closeNewItemModal() {\n    this.showNewItemModal = false;\n  }\n\n  openBasicModal() {\n    let prod = this.product;\n    this.basicInfoEditObj = {\n      name: prod.name,\n      msrp: prod.msrp,\n      fees: prod.fees,\n      status: prod.status\n    };\n    this.showBasicModal = true;\n  }\n\n  closeBasicModal() {\n    this.showBasicModal = false;\n  }\n\n  openFeeModal() {\n    this.feeEditArr = this.product.fees;\n    this.showFeeModal = true;\n  }\n\n  closeFeeModal() {\n    this.showFeeModal = false;\n  }\n\n  openImageModal() {\n    this.showImageModal = true;\n  }\n\n  closeImageModal() {\n    this.showImageModal = false;\n  }\n\n  cancelItemEdit() {\n    this.prodItemEditEnd();\n    this.getProduct();\n  }\n\n  saveNewItem(value) {\n    api.post('productitem/', value).then(resp => {\n      this.getProductItems();\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n    this.closeNewItemModal();\n  }\n\n  submitBasic() {\n    (this.$refs.basicInfo as VForm).validate().then( valid => {\n      if(valid) {\n        let body = this.basicInfoEditObj;\n        this.submitEdit(body);\n      }\n    });\n  }\n\n  submitFees() {\n    let body = { fees: this.feeEditArr };\n    this.submitEdit(body);\n  }\n\n  submitImages() {\n    let body = { images: this.product.images };\n    this.submitEdit(body);\n  }\n\n  submitProdItems() {\n    let body = { productItemQuantities: this.productItemQty };\n    this.submitEdit(body);\n  }\n\n  submitEdit(body) {\n    api.put('product/' + this.product.id, body).then(resp => {\n      this.getProduct();\n      this.$toast.success('Product updated');\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n    this.closeBasicModal();\n    this.closeFeeModal();\n    this.closeImageModal();\n    this.editProdItems = false;\n  }\n}\n",{"version":3,"sources":["product-info.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"product-info.vue","sourceRoot":"src/pages/products","sourcesContent":["<template>\n  <div>\n    <error-banner v-model=\"errorList\" />\n    <div class=\"row\">\n      <div class=\"col-md-5\">\n        <panel title=\"Summary\">\n          <list-group :iconList=\"true\" v-if=\"product\" title=\"Basic Info\" :showBtn=\"true\" @util-click=\"openBasicModal\">\n            <list-group-item icon=\"address-card\">\n              Name <span>{{product.name}}</span>\n            </list-group-item>\n            <list-group-item icon=\"tag\">\n              MSRP <span>{{product.msrp | currency}}</span>\n            </list-group-item>\n            <list-group-item icon=\"ellipsis-h\" v-if=\"product.status\">\n              Status <badge badgeType=\"outline\" badgeStyle=\"success\">{{product.status.name}}</badge>\n            </list-group-item>\n          </list-group>\n          <section-title :showBtn=\"true\" @util-click=\"openFeeModal\">Fees</section-title>\n          <no-results v-if=\"!product.fees || !product.fees.length\" @button-click=\"openFeeModal\" header=\"No Fees Assigned\" btnLabel=\"Add Fee\"></no-results>\n          <list-group :iconList=\"true\" v-if=\"product.fees && product.fees.length\">\n            <list-group-item v-for=\"(fee, index) in product.fees\" icon=\"receipt\" color=\"yellow\" :key=\"index\">\n              {{fee.name}} <span>{{fee.amount | fee(fee.type)}}</span>\n            </list-group-item>\n          </list-group>\n        </panel>\n        <panel title=\"Inventory\">\n          <inventory :inventory=\"product.inventory\" :id=\"product.id\" objectType=\"product\"></inventory>\n        </panel>\n        <panel title=\"Product Identifiers\">\n          <product-identifier :prodIds=\"product.productIdentifiers\" :id=\"product.id\" objectType=\"product\"></product-identifier>\n        </panel>\n        <panel title=\"Images\">\n          <app-button slot=\"utility\" btnStyle=\"link\" size=\"xs\" icon=\"edit\" @click=\"openImageModal\"></app-button>\n          <no-results v-if=\"!product.images || !product.images.length\" header=\"No Images to Show\" @button-click=\"openImageModal\" btnLabel=\"Add Image\" :icon=\"['far', 'images']\"></no-results>\n          <image-gallery v-else :images=\"product.images\" />\n        </panel>\n      </div>\n      <div class=\"col-md-7\">\n        <panel title=\"Cost Breakdown\">\n          <doughnut-chart :options=\"chartOptions\" :innerText=\"summaryData.msrp\" :height=\"140\" :chart-data=\"chartData\"></doughnut-chart>\n          <!-- <list-group v-if=\"summaryData\" title=\"Summary\">\n            <list-group-item icon=\"tag\">\n              MSRP <badge>{{summaryData.msrp | currency}}</badge>\n            </list-group-item>\n            <list-group-item icon=\"receipt\">\n              Fees <badge>{{summaryData.fees | currency}}</badge>\n            </list-group-item>\n            <list-group-item icon=\"hand-holding-usd\">\n              Product Cost <badge>{{summaryData.prodItemsCost | currency}}</badge>\n            </list-group-item>\n            <list-group-item icon=\"dollar-sign\">\n              Profit <badge badgeStyle=\"success\">{{summaryData.profit | currency}}</badge>\n            </list-group-item>\n          </list-group> -->\n        </panel>\n        <transition name=\"expand\">\n          <panel v-if=\"productItemQty.length\" title=\"Product Item Quantities\">\n            <app-button v-if=\"!editProdItems\" slot=\"utility\" btnStyle=\"link\" size=\"xs\" icon=\"edit\" @click=\"prodItemEditStart\"></app-button>\n            <div v-else slot=\"utility\">\n              <app-button v-if=\"editProdItems\" :linkBtn=\"true\" @click=\"cancelItemEdit\">Cancel</app-button>\n              <app-button v-if=\"editProdItems\" @click=\"submitProdItems\">Save</app-button>\n            </div>\n            <app-button v-if=\"editProdItems\" :linkBtn=\"true\" size=\"xs\" icon=\"plus-circle\" @click=\"openNewItemModal\">New Product Item</app-button>\n            <app-table :columns=\"itemCols\">\n              <tr v-for=\"(record, index) in filteredProdItems\" :key=\"`row-${index}`\">\n                <td>\n                  <counter v-if=\"editProdItems\" :value=\"getCount(record)\" @input=\"(val) => changeCount(val, record)\"></counter>\n                  <badge v-else badgeStyle=\"info\">{{ getCount(record) }}</badge>\n                </td>\n                <td>\n                  <app-button size=\"xs\" btnStyle=\"link\" @click=\"openDetails(record)\">{{record.name}}</app-button>\n                </td>\n                <td>{{ record.caseQty }}</td>\n                <td>{{ record.itemCost }}</td>\n                <td>{{ record.supplier && record.supplier.name }}</td>\n              </tr>\n            </app-table>\n            <pagination :totalRecords=\"productItems.length\" @change=\"changePage\" />\n          </panel>\n        </transition>\n      </div>\n    </div>\n    <product-item-panel :open=\"showDetails\" @close=\"closeDetails()\" :item=\"selectedItem\" />\n    <modal size=\"lg\" title=\"New Product Item\" :open=\"showNewItemModal\">\n      <new-product-item @cancel=\"closeNewItemModal\" @submit=\"saveNewItem\" />\n    </modal>\n    <modal title=\"Edit Basic Info\" :open=\"showBasicModal\">\n      <validation-observer ref=\"basicInfo\">\n        <form @submit.prevent=\"submitBasic\" novalidate>\n          <div class=\"row\">\n            <div class=\"col-md-7\">\n              <input-validate name=\"name\" label=\"Name\" rules=\"required\" v-model=\"basicInfoEditObj.name\" />\n            </div>\n            <div class=\"col-md-5\">\n              <input-validate name=\"msrp\" label=\"MSRP\" rules=\"required\" inputType=\"number\" :numberStep=\"0.1\" v-model=\"basicInfoEditObj.msrp\" />\n            </div>\n            <div class=\"col-md-6\">\n              <status-select v-model=\"basicInfoEditObj.status\" />\n            </div>\n          </div>\n          <button-group>\n            <app-button :linkBtn=\"true\" @click=\"closeBasicModal\">Cancel</app-button>\n            <app-button btnType=\"submit\">Save</app-button>\n          </button-group>\n        </form>\n      </validation-observer>\n    </modal>\n    <modal title=\"Fees\" :open=\"showFeeModal\">\n      <form v-if=\"!editFeeOptions\" @submit.prevent=\"submitFees\">\n        <fee-input v-model=\"feeEditArr\" @edit-click=\"editFeeOptions = true\"  />\n        <button-group>\n          <app-button :linkBtn=\"true\" @click=\"closeFeeModal\">Cancel</app-button>\n          <app-button btnType=\"submit\">Save</app-button>\n        </button-group>\n      </form>\n      <fee-editor v-else @back-click=\"editFeeOptions = false\" />\n    </modal>\n    <modal title=\"Images\" :open=\"showImageModal\">\n      <form @submit.prevent=\"submitImages\">\n        <image-editor v-model=\"product.images\" />\n        <button-group>\n          <app-button :linkBtn=\"true\" @click=\"closeImageModal\">Cancel</app-button>\n          <app-button btnType=\"submit\">Save</app-button>\n        </button-group>\n      </form>\n    </modal>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Prop, Vue } from 'vue-property-decorator';\nimport {\n  Panel,\n  ListGroup,\n  ListGroupItem,\n  NoResults,\n  Badge,\n  DataImage,\n  AppTable,\n  Modal,\n  AppButton,\n  Counter,\n  SectionTitle,\n  ImageGallery,\n  InputField,\n  InputValidate,\n  MultiSelect,\n  StatusSelect,\n  Radio,\n  FeeInput,\n  FeeEditor,\n  ImageEditor,\n  ButtonGroup,\n  ErrorBanner,\n  Toggle,\n  Pagination\n} from '@/components';\nimport { DoughnutChart } from '@/charts';\nimport api from '@/api';\nimport { IProduct, IProductItem, IProductItemQuantity, IFee, IMedia, VForm } from '@/interfaces';\nimport ProductItemPanel from './product-item-panel.vue';\nimport NewProductItem from './product-items/new-product-item.vue';\nimport deepCopy from '@/utils';\nimport { ValidationObserver } from 'vee-validate';\nimport ProductIdentifier from './product-items/product-identifier.vue';\nimport Inventory from './product-items/inventory.vue';\n\n@Component({\n  components: {\n    Panel,\n    ListGroup,\n    ListGroupItem,\n    Badge,\n    DoughnutChart,\n    NoResults,\n    DataImage,\n    AppTable,\n    Modal,\n    ProductItemPanel,\n    AppButton,\n    Counter,\n    NewProductItem,\n    SectionTitle,\n    ImageGallery,\n    InputField,\n    InputValidate,\n    MultiSelect,\n    StatusSelect,\n    Radio,\n    FeeInput,\n    FeeEditor,\n    ImageEditor,\n    ButtonGroup,\n    ValidationObserver,\n    ErrorBanner,\n    Toggle,\n    ProductIdentifier,\n    Inventory,\n    Pagination\n  }\n})\nexport default class ProductInfo extends Vue {\n  product: IProduct = {};\n  chartData: any = {};\n  summaryData: any = {};\n  productImages = [];\n  productItems: IProductItem[] = [];\n  filteredProdItems: IProductItem[] = [];\n  productItemQty: IProductItemQuantity[] = [];\n  selectedItem = {};\n  showDetails = false;\n  saveDisabled = true;\n  showNewItemModal = false;\n  editProdItems = false;\n  showBasicModal = false;\n  basicInfoEditObj: IProduct = {};\n  showFeeModal = false;\n  editFeeOptions = false;\n  feeEditArr: IFee[] = [];\n  showImageModal = false;\n  images: IMedia[] = [];\n  selectedImages: IMedia[];\n  itemCols = [\n    { label: 'Quantity', slotName: 'count' },\n    { label: 'Name', slotName: 'name' },\n    { label: 'Case Cost', selector: 'caseCost' },\n    { label: 'Item Cost', selector: 'itemCost' },\n    { label: 'Supplier', selector: 'supplier.name' }\n  ];\n  statusOptions = [];\n  errorList: string[] = [];\n  chartOptions = {\n    responsive: true,\n    maintainAspectRatio: true,\n    legend: { position: 'bottom', labels: { boxWidth: 15, fontSize: 14, fontColor: '#444'}}\n  };\n\n  created() {\n    this.getProduct();\n    this.getStatuses();\n  }\n\n  getProduct() {\n    const id = this.$route.params.id;\n    api.get('product/' + id).then(resp => {\n      this.product = resp.data;\n      this.productItemQty = this.product.productItemQuantities || [];\n      if(this.productItemQty.length) {\n        this.getProductItems();\n      }\n      this.calculateCost();\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  getProductItems() {\n    api.get('productitem/all').then(resp => {\n      this.productItems = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  getStatuses() {\n    api.get('status/all').then(resp => {\n      this.statusOptions = resp.data;\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n  }\n\n  calculateCost() {\n    let product = this.product;\n    let fees = 0;\n    product.fees.forEach( fee => {\n      fees += fee.amount;\n    });\n\n    let prodItemsCost = 0;\n    product.productItemQuantities.forEach( item => {\n      prodItemsCost += item.productItem.itemCost * item.count;\n    });\n    prodItemsCost = parseInt(prodItemsCost.toFixed(2));\n    const cost = fees + prodItemsCost;\n    let profit = parseInt((product.msrp - cost).toFixed(2));\n    if(profit < 0) {\n      profit = 0;\n    }\n\n    this.chartData = {\n      labels: ['Fees', 'Product Cost', 'Profit'],\n      datasets: [{\n        data: [fees, prodItemsCost, profit],\n        backgroundColor: ['#ff6384', '#ffcd56', '#00ad10']\n      }]\n    }\n\n    this.summaryData = {\n      msrp: product.msrp,\n      fees: fees,\n      prodItemsCost: prodItemsCost,\n      profit: profit\n    }\n  }\n\n  changePage(range) {\n    let prodItems = deepCopy(this.productItems);\n    this.filteredProdItems = prodItems.splice(range.start, range.end);\n  }\n\n  prodItemEditStart() {\n    this.filteredProdItems = this.productItems;\n    this.editProdItems = true;\n  }\n\n  prodItemEditEnd() {\n    this.filteredProdItems = this.productItems.filter(item => this.getCount(item) > 0);\n    this.editProdItems = false;\n  }\n\n  findCountObj(id) {\n    return this.productItemQty.find(item => item.productItem.id === id);\n  }\n\n  getCount(item) {\n    let countItem = this.findCountObj(item.id);\n    return countItem ? countItem.count : 0;\n  }\n\n  changeCount(val, item) {\n    let countItem = this.findCountObj(item.id);\n    let prodItemQty = this.productItemQty;\n    let count = val !== '' ? parseInt(val) : 0;\n    if (countItem) {\n      if (count === 0) {\n        let index = prodItemQty.findIndex(obj => obj.productItem.id === item.id);\n        prodItemQty.splice(index, 1);\n      }\n      else {\n        countItem.count = count;\n      }\n    }\n    else {\n      prodItemQty.push({ count: count, productItem: item });\n    }\n    this.calculateCost();\n    this.saveDisabled = false;\n  }\n\n  openDetails(obj) {\n    this.showDetails = true;\n    this.selectedItem = obj;\n  }\n\n  closeDetails() {\n    this.showDetails = false;\n    this.selectedItem = {};\n  }\n\n  openNewItemModal() {\n    this.showNewItemModal = true;\n  }\n\n  closeNewItemModal() {\n    this.showNewItemModal = false;\n  }\n\n  openBasicModal() {\n    let prod = this.product;\n    this.basicInfoEditObj = {\n      name: prod.name,\n      msrp: prod.msrp,\n      fees: prod.fees,\n      status: prod.status\n    };\n    this.showBasicModal = true;\n  }\n\n  closeBasicModal() {\n    this.showBasicModal = false;\n  }\n\n  openFeeModal() {\n    this.feeEditArr = this.product.fees;\n    this.showFeeModal = true;\n  }\n\n  closeFeeModal() {\n    this.showFeeModal = false;\n  }\n\n  openImageModal() {\n    this.showImageModal = true;\n  }\n\n  closeImageModal() {\n    this.showImageModal = false;\n  }\n\n  cancelItemEdit() {\n    this.prodItemEditEnd();\n    this.getProduct();\n  }\n\n  saveNewItem(value) {\n    api.post('productitem/', value).then(resp => {\n      this.getProductItems();\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n    this.closeNewItemModal();\n  }\n\n  submitBasic() {\n    (this.$refs.basicInfo as VForm).validate().then( valid => {\n      if(valid) {\n        let body = this.basicInfoEditObj;\n        this.submitEdit(body);\n      }\n    });\n  }\n\n  submitFees() {\n    let body = { fees: this.feeEditArr };\n    this.submitEdit(body);\n  }\n\n  submitImages() {\n    let body = { images: this.product.images };\n    this.submitEdit(body);\n  }\n\n  submitProdItems() {\n    let body = { productItemQuantities: this.productItemQty };\n    this.submitEdit(body);\n  }\n\n  submitEdit(body) {\n    api.put('product/' + this.product.id, body).then(resp => {\n      this.getProduct();\n      this.$toast.success('Product updated');\n    })\n    .catch(error => {\n      this.errorList.push(error.response.data.message);\n    });\n    this.closeBasicModal();\n    this.closeFeeModal();\n    this.closeImageModal();\n    this.editProdItems = false;\n  }\n}\n</script>\n"]}]}